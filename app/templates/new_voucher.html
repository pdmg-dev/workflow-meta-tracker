{# app/templates/new_voucher.html #}
{% extends "base.html" %}
{% block content %}
  <div class="content-container">
    <div class="content-header">
      <h4 class="content-title">Vouchers</h4>
    </div>

    <div class="new-voucher-form">
      <div class="card">
        <h6 class="card-header text-muted">Today's Added Voucher</h6>
        <div class="card-body" id="todays-vouchers-body">
          <div class="table-container scroll-area">{% include 'voucher/_today.html' %}</div>
        </div>
      </div>

      <div class="card">
        <h6 class="card-header text-muted">New Voucher</h6>
        <div class="card-body">
          <div id="entry-form-container" class="h-100">{% include 'voucher/form.html' %}</div>
        </div>
      </div>

      <div class="card">
        <h6 class="card-header text-muted">Preview</h6>
        <div class="card-body" id="voucher-details-preview">
          <div>Select a voucher to show details preview.</div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block script %}
  <script>
    document.body.addEventListener("voucherSaved", (e) => {
      const newId = e.detail.id; // <-- grab the id from the trigger
      htmx.ajax("GET", `/voucher/preview/${newId}`, {
        target: "#voucher-details-preview",
        swap: "innerHTML",
      });
      htmx.ajax("GET", "{{ url_for('voucher.todays_vouchers') }}", {
        target: "#todays-vouchers-body",
        swap: "innerHTML",
      });
    });
  </script>
{% endblock %}

{% block style %}
  <style>
    .new-voucher-form {
      display: grid;
      grid-template-columns: 1fr 3fr 2fr;
      gap: 1rem;
      min-height: 0;
      overflow: hidden;
    }
  </style>
{% endblock %}
